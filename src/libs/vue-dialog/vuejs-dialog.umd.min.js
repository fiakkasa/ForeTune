(function(l,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(l=typeof globalThis<"u"?globalThis:l||self,o(l.VuejsDialog={},l.Vue))})(this,function(l,o){"use strict";var ie=Object.defineProperty;var le=(l,o,h)=>o in l?ie(l,o,{enumerable:!0,configurable:!0,writable:!0,value:h}):l[o]=h;var u=(l,o,h)=>le(l,typeof o!="symbol"?o+"":o,h);const h={class:"dg-btn-loader"},S=Object.assign({name:"ButtonLoader"},{__name:"ButtonLoader",setup(e){return(t,n)=>(o.openBlock(),o.createElementBlock("span",h,n[0]||(n[0]=[o.createElementVNode("span",{class:"dg-circles"},[o.createElementVNode("span",{class:"dg-circle"}),o.createElementVNode("span",{class:"dg-circle"}),o.createElementVNode("span",{class:"dg-circle"})],-1)])))}}),c="__VUEJS_DIALOG__",f={ALERT:"alert",CONFIRM:"confirm",PROMPT:"prompt"},d={BASIC:"basic",SOFT:"soft",HARD:"hard"},E={FADE:"dg-fade",ZOOM:"dg-zoom",BOUNCE:"dg-bounce"},g={MAIN_CONTENT:"mainContent",BODY:"body",FOOTER:"footer",OK:"ok",CANCEL:"cancel"},T={[g.MAIN_CONTENT]:"",[g.BODY]:"",[g.FOOTER]:"",[g.OK]:"",[g.CANCEL]:""},L={html:!1,loader:!1,reverse:!1,backdropClose:!1,okText:"Continue",cancelText:"Close",type:d.BASIC,window:f.CONFIRM,message:"Please confirm to proceed",clicksCount:3,animation:"zoom",customClass:T,verification:"continue",verificationHelp:'Type "[+:verification]" below to confirm',promptHelp:'Type in the box below and click "[+:okText]"'};var B=(e=>(e.alert="alert",e.confirm="confirm",e.prompt="prompt",e))(B||{});const H=o.defineComponent({name:"OkButton",data(){return{clicks_count:0}},emits:{click:()=>!0},props:{visible:{required:!1,type:Boolean,default:!0},options:{required:!0,type:Object},focus:{required:!1,type:Boolean,default:!1},loading:{required:!1,type:Boolean,default:!1},btnState:{required:!0,type:Object,default:{disabled:!0,visible:!0}}},mounted(){this.focus&&this.$refs.btn.focus()},computed:{soft_confirm(){return this.options.type===d.SOFT},hard_confirm(){return this.options.type===d.HARD},disabled(){return this.btnState.disabled},clicks_remaining(){return Math.max(this.options.clicksCount-this.clicks_count,0)}},methods:{proceed(){!this.disabled&&this.validateProceed()&&this.$emit("click")},validateProceed(){switch(this.options.type){case d.SOFT:return this.clicks_count++,this.clicks_count>=this.options.clicksCount;case d.BASIC:default:return!0}}},components:{BtnLoader:S}}),A=(e,t)=>{const n=e.__vccOpts||e;for(const[s,i]of t)n[s]=i;return n},$=["disabled"],M={class:"dg-btn-content"},V={key:0};function P(e,t,n,s,i,p){return e.visible?(o.openBlock(),o.createElementBlock("button",{key:0,class:o.normalizeClass(["dg-btn","dg-btn--ok",{"dg-btn--loading":e.loading},{"dg-pull-right":!e.options.reverse}]),onClick:t[0]||(t[0]=o.withModifiers(r=>e.proceed(),["prevent"])),ref:"btn",disabled:e.disabled},[o.createElementVNode("span",M,[o.renderSlot(e.$slots,"default"),e.soft_confirm?(o.openBlock(),o.createElementBlock("span",V,"("+o.toDisplayString(e.clicks_remaining)+")",1)):o.createCommentVNode("",!0)]),e.loading?(o.openBlock(),o.createBlock(o.resolveDynamicComponent("BtnLoader"),{key:0})):o.createCommentVNode("",!0)],10,$)):o.createCommentVNode("",!0)}const k=A(H,[["render",P]]),C=o.defineComponent({name:"CancelButton",__name:"CancelButton",props:{visible:{required:!1,type:Boolean,default:!0},options:{required:!0,type:Object},focus:{required:!1,type:Boolean,default:!1},loading:{required:!1,type:Boolean,default:!1}},emits:{click:()=>!0},setup(e){const t=e,n=o.ref(void 0);return o.onMounted(()=>{t.focus&&n.value.focus()}),(s,i)=>t.visible?(o.openBlock(),o.createElementBlock("button",{key:0,class:o.normalizeClass(["dg-btn","dg-btn--cancel",{"dg-pull-right":t.options.reverse}]),onClick:i[0]||(i[0]=o.withModifiers(p=>s.$emit("click"),["prevent"])),ref:n.value},[o.renderSlot(s.$slots,"default")],2)):o.createCommentVNode("",!0)}}),j=o.defineComponent({name:"DialogWindow",data:function(){return{input:"",show:!0,loading:!1,closed:!1,customClass:Object.assign({},T),endedAnimations:[]}},props:{id:{type:String,required:!0},options:{type:Object,required:!0},escapeKeyClose:{type:Boolean,default:!1}},watch:{escapeKeyClose:function(e){e===!0&&(this.cancelBtnDisabled?this.proceed():this.cancel())}},computed:{animation(){let e=this.options.animation.toUpperCase();return Object.prototype.hasOwnProperty.call(E,e)?E[e]:E.ZOOM},loaderEnabled(){return this.options.loader},isHardConfirm(){return this.options.window===f.CONFIRM&&this.options.type===d.HARD},isPrompt(){return this.options.window===f.PROMPT},leftBtnComponent(){return this.options.reverse?k:C},rightBtnComponent(){return this.options.reverse?C:k},hardConfirmHelpText(){return this.options.verificationHelp.replace(/\[\+:(\w+)]/g,(e,t)=>this.options[t]||e)},promptHelpText(){return this.options.promptHelp.replace(/\[\+:(\w+)]/g,(e,t)=>this.options[t]||e)},messageHasTitle(){var e;return!!((e=this.options.message)!=null&&e.title)},messageTitle(){return this.messageHasTitle?this.options.message.title:null},messageBody(){return this.options.message.body},cancelBtnDisabled(){return this.options.window===f.ALERT},okBtnDisabled(){return this.options.window===f.CONFIRM&&this.options.type===d.HARD&&this.input!==this.options.verification},leftBtnVisible(){return!this.cancelBtnDisabled||this.options.reverse},rightBtnVisible(){return!this.cancelBtnDisabled||!this.options.reverse},leftBtnFocus(){return!this.isHardConfirm&&this.options.reverse},rightBtnFocus(){return!this.isHardConfirm&&!this.options.reverse},leftBtnText(){return this.options.reverse?this.options.okText:this.options.cancelText},rightBtnText(){return this.options.reverse?this.options.cancelText:this.options.okText},btnState(){return{loading:this.loading,options:this.options}},rightBtnState(){const{reverse:e}=this.options;return{...this.btnState,component:e?C:k,disabled:this.okBtnDisabled,visible:this.options.window!==f.ALERT||!e}},leftBtnState(){const{reverse:e}=this.options;return{...this.btnState,component:e?k:C,disabled:this.cancelBtnDisabled,visible:!this.cancelBtnDisabled||e}}},mounted(){this.setCustomClasses(),(this.isHardConfirm||this.isPrompt)&&this.$refs.inputElem&&this.$refs.inputElem.focus()},methods:{closeAtOutsideClick(){this.options.backdropClose&&this.cancel()},clickRightBtn(){this.options.reverse?this.cancel():this.proceed(this.getDefaultData())},clickLeftBtn(){this.options.reverse?this.proceed(this.getDefaultData()):this.cancel()},submitDialogForm(){this.okBtnDisabled||this.proceed(this.getDefaultData())},getDefaultData(){return this.isPrompt?this.input:null},proceed(e=null){this.loaderEnabled?(this.switchLoadingState(!0),this.options.promiseResolver({close:this.close,data:e})):(this.options.promiseResolver({data:e}),this.close())},cancel(){this.loading||this.close()},switchLoadingState(e=null){e===null&&(e=!this.loading),this.loading=!!e},close(){this.show=!1,this.closed=!0},animationEnded(e){this.endedAnimations.push(e),this.endedAnimations.indexOf("backdrop")!==-1&&this.endedAnimations.indexOf("content")!==-1&&(this.options.promiseResolver({canceled:!0}),this.$emit("close",this.id))},setCustomClasses(){Object.prototype.hasOwnProperty.call(this.options,"customClass")&&Object.keys(this.options.customClass).forEach(e=>{Object.keys(T).includes(e)||console.warn(`[WARNING]: Custom class name "${e}" is not recognized!`)}),this.customClass=Object.assign(this.customClass,this.options.customClass)}},beforeUnmount(){this.closed||(this.cancelBtnDisabled?this.proceed():this.cancel())},components:{CancelBtn:C,OkBtn:k}}),F={key:0,class:"dg-backdrop"},K={class:"dg-content-cont dg-content-cont--floating"},q=["innerHTML"],z={key:1,class:"dg-title"},U=["innerHTML"],v={key:2,class:"dg-content"},Y={for:"dg-input-elem",style:{"font-size":"13px"}},W=["placeholder"],_=["innerHTML"],G={key:1},Z=["innerHTML"],J={key:1};function Q(e,t,n,s,i,p){return o.openBlock(),o.createElementBlock("div",null,[o.createVNode(o.Transition,{name:"dg-backdrop",appear:"",onAfterLeave:t[0]||(t[0]=r=>e.animationEnded("backdrop"))},{default:o.withCtx(()=>[e.show?(o.openBlock(),o.createElementBlock("div",F)):o.createCommentVNode("",!0)]),_:1}),o.createVNode(o.Transition,{name:e.animation,onAfterLeave:t[7]||(t[7]=r=>e.animationEnded("content")),appear:""},{default:o.withCtx(()=>[e.show?(o.openBlock(),o.createElementBlock("div",{key:0,onClick:t[6]||(t[6]=(...r)=>e.closeAtOutsideClick&&e.closeAtOutsideClick(...r)),class:o.normalizeClass(["dg-container",{"dg-container--has-input":e.isHardConfirm||e.isPrompt}])},[o.createElementVNode("div",K,[o.createElementVNode("div",{class:o.normalizeClass(["dg-main-content",e.customClass.mainContent]),onClick:t[5]||(t[5]=o.withModifiers(()=>{},["stop"]))},[o.createElementVNode("div",{class:o.normalizeClass(["dg-content-body",e.customClass.body,{"dg-content-body--has-title":e.messageHasTitle}])},[e.messageHasTitle?(o.openBlock(),o.createElementBlock(o.Fragment,{key:0},[e.options.html?(o.openBlock(),o.createElementBlock("h6",{key:0,class:"dg-title",innerHTML:e.messageTitle},null,8,q)):(o.openBlock(),o.createElementBlock("h6",z,o.toDisplayString(e.messageTitle),1))],64)):o.createCommentVNode("",!0),e.options.html?(o.openBlock(),o.createElementBlock("div",{key:1,class:"dg-content",innerHTML:e.messageBody},null,8,U)):(o.openBlock(),o.createElementBlock("div",v,o.toDisplayString(e.messageBody),1)),e.isHardConfirm||e.isPrompt?(o.openBlock(),o.createElementBlock("form",{key:3,class:"dg-form",autocomplete:"off",onSubmit:t[2]||(t[2]=o.withModifiers((...r)=>e.submitDialogForm&&e.submitDialogForm(...r),["prevent"]))},[o.createElementVNode("label",Y,o.toDisplayString(e.isPrompt?e.promptHelpText:e.hardConfirmHelpText),1),o.withDirectives(o.createElementVNode("input",{type:"text",placeholder:e.isPrompt?"":e.options.verification,"onUpdate:modelValue":t[1]||(t[1]=r=>e.input=r),autocomplete:"off",id:"dg-input-elem",ref:"inputElem",style:{width:"100%","margin-top":"10px",padding:"5px 15px","font-size":"16px","border-radius":"4px",border:"2px solid #eee"}},null,8,W),[[o.vModelText,e.input]])],32)):o.createCommentVNode("",!0)],2),o.createElementVNode("div",{class:o.normalizeClass(["dg-content-footer",e.customClass.footer])},[(o.openBlock(),o.createBlock(o.resolveDynamicComponent(e.leftBtnComponent),{onClick:t[3]||(t[3]=r=>e.clickLeftBtn()),"btn-state":e.leftBtnState,loading:e.loading,class:o.normalizeClass(e.customClass.cancel),visible:e.leftBtnVisible,options:e.options,focus:e.leftBtnFocus},{default:o.withCtx(()=>[e.options.html?(o.openBlock(),o.createElementBlock("span",{key:0,innerHTML:e.leftBtnText},null,8,_)):(o.openBlock(),o.createElementBlock("span",G,o.toDisplayString(e.leftBtnText),1))]),_:1},8,["btn-state","loading","class","visible","options","focus"])),(o.openBlock(),o.createBlock(o.resolveDynamicComponent(e.rightBtnState.component),{onClick:t[4]||(t[4]=r=>e.clickRightBtn()),"btn-state":e.rightBtnState,loading:e.loading,class:o.normalizeClass(e.customClass.ok),visible:e.rightBtnVisible,options:e.options,focus:e.rightBtnFocus},{default:o.withCtx(()=>[e.options.html?(o.openBlock(),o.createElementBlock("span",{key:0,innerHTML:e.rightBtnText},null,8,Z)):(o.openBlock(),o.createElementBlock("span",J,o.toDisplayString(e.rightBtnText),1))]),_:1},8,["btn-state","loading","class","visible","options","focus"])),t[8]||(t[8]=o.createElementVNode("div",{class:"dg-clear"},null,-1))],2)],2)])],2)):o.createCommentVNode("",!0)]),_:1},8,["name"])])}const X=A(j,[["render",Q]]),x=()=>{},D=function(e){return Object.assign({},e)},R=function(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);return Object.assign(...e.map(D))},ee=function(e){if(document.createEvent){const t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),e.dispatchEvent(t)}else document.createEventObject?e.fireEvent("onclick"):typeof e.onclick=="function"&&e.onclick()},te=function(e,t,n){let s;const i=e.length;for(s=0;s<i;s++)if(e[s][n]===t)return s;return-1},I=(e,t)=>e.filter((n,s)=>s!==t),oe=o.defineComponent({data:function(){return{dialogsARR:[],registeredViews:{}}},created(){document.addEventListener("keydown",this.escapeKeyListener)},beforeUnmount(){document.removeEventListener("keydown",this.escapeKeyListener)},watch:{dialogsARR:{handler(e){let t="dg-open";const n=document.getElementsByTagName("body")[0];n&&(e.length&&!n.classList.contains(t)?n.classList.add(t):!e.length&&n&&n.classList.contains(t)&&n.classList.remove(t))}}},methods:{commit(e){const t="dialog."+Date.now();return this.dialogsARR.push({...e,id:t,escapeKeyClose:!1}),t},forceCloseAll(){this.dialogsARR.forEach((e,t)=>{this.dialogsARR=I(this.dialogsARR,t)})},destroyDialog(e){let t=te(this.dialogsARR,e,"id");t!==-1&&(this.dialogsARR=I(this.dialogsARR,t))},escapeKeyListener(e){if(e.keyCode!==27)return;let t=-1+this.dialogsARR.length;t>-1&&(e.preventDefault(),this.dialogsARR[t].escapeKeyClose=!0)}},components:{DialogWindow:X}});function ne(e,t,n,s,i,p){const r=o.resolveComponent("DialogWindow");return o.openBlock(),o.createElementBlock("div",null,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(e.dialogsARR,m=>(o.openBlock(),o.createBlock(r,{options:m,id:m.id,key:m.id,escapeKeyClose:m.escapeKeyClose,registeredViews:e.registeredViews,onClose:e.destroyDialog},null,8,["options","id","escapeKeyClose","registeredViews","onClose"]))),128))])}const se=A(oe,[["render",ne]]);class y{constructor(t){u(this,"shouldIgnoreClick",!1);this.dialog=t}getConfirmMessage(t){return t.value&&t.value.message?t.value.message:typeof t.value=="string"?t.value:null}getOptions(t){const n=typeof(t==null?void 0:t.value)=="object"?D(t.value):{};return delete n.ok,delete n.cancel,t!=null&&t.arg&&Object.prototype.hasOwnProperty.call(d,t.arg.toUpperCase())&&(n.type=d[t.arg.toUpperCase()]),n}getProceedCallback(t,n){return t!=null&&t.value&&t.value.ok?s=>{const i={...s,node:n};t.value.ok(i)}:s=>{s.close&&s.close(),this.shouldIgnoreClick=!0,ee(n),this.shouldIgnoreClick=!1}}getCancelCallback(t){return t!=null&&t.value&&t.value.cancel?t.value.cancel:x}clickHandler(t,n,s){if(this.shouldIgnoreClick)return;t.preventDefault(),t.stopImmediatePropagation();const i=this.getOptions(s),p=this.getConfirmMessage(s),r=this.getProceedCallback(s,n),m=this.getCancelCallback(s);this.dialog.confirm(p,i).then(w=>{if(w.canceled)return m.call(m,w);r.call(r,w)})}static createInstaller(t){const n=new y(t);return{mounted:(s,i)=>{s[c]=s[c]||{},s[c].clickHandler=p=>n.clickHandler(p,s,i),s.addEventListener("click",s[c].clickHandler,!0)},updated:(s,i)=>{s.removeEventListener("click",s[c].clickHandler,!0),s[c].clickHandler=p=>n.clickHandler(p,s,i),s.addEventListener("click",s[c].clickHandler,!0)},unmounted:s=>{s.removeEventListener("click",s[c].clickHandler,!0),delete s[c]}}}}const O="$dialog",N=Symbol.for(O),a=class a{constructor(t,n){u(this,"dgApp");u(this,"dgAppComponentInstance");u(this,"mounted",!1);this.contextApp=t,this.globalOptions=n,this.globalOptions=R(L,n)}open(t,n,s={}){return this.mountIfNotMounted(),new Promise(i=>{s.window=t,s.promiseResolver=i,n&&(s.message=typeof n=="string"?{title:"",body:n}:n),this.dgAppComponentInstance.commit(R(this.globalOptions,s))})}alert(t,n){return this.open(B.alert,t,{...n||{},...t?{message:t}:{}})}confirm(t,n){return this.open(B.confirm,t,{...n||{},...t?{message:t}:{}})}prompt(t,n){return this.open(B.prompt,t,{...n||{},...t?{message:t}:{}})}mountIfNotMounted(){if(this.mounted)return;const t=o.createApp(se),n=document.createElement("div");document.querySelector("body").appendChild(n),this.contextApp&&(t.config.globalProperties=this.contextApp.config.globalProperties,t._context.components=this.contextApp._context.components,t._context.directives=this.contextApp._context.directives,t._context.mixins=this.contextApp._context.mixins,t._context.provides=this.contextApp._context.provides),this.dgApp=t,this.dgAppComponentInstance=t.mount(n),this.mounted=!0}destroy(){this.mounted&&(this.dgApp.unmount(),delete this.dgAppComponentInstance,delete this.dgApp,this.mounted=!1)}static install(t,n){a.dialogInstance&&(a.dialogInstance.destroy(),delete a.dialogInstance);const s=new a(t,n);a.dialogInstance=s,t.directive("confirm",y.createInstaller(s)),t.provide(N,s),Object.defineProperties(t.config.globalProperties,{[O]:{get:()=>s}})}static getInstance(){if(!a.dialogInstance)throw new Error("PromiseDialog.getInstance called before installation");return a.dialogInstance}static installStandalone(t){return a.dialogInstance||(a.dialogInstance=new a(void 0,t)),a.dialogInstance}};u(a,"dialogInstance");let b=a;l.ConfirmDirective=y,l.PromiseDialog=b,l.default=b,l.injectionKey=N,l.propertyKey=O,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
